{"ast":null,"code":"/**\n * This module contains some common helpers shared between middlewares\n */\n'use strict';\n\nconst mime = require('mime');\nconst parseRange = require('range-parser');\nconst log = require('../logger').create('web-server');\nfunction createServeFile(fs, directory, config) {\n  const cache = Object.create(null);\n  return function (filepath, rangeHeader, response, transform, content, doNotCache) {\n    let responseData;\n    function convertForRangeRequest() {\n      const range = parseRange(responseData.length, rangeHeader);\n      if (range === -2) {\n        return 200; // malformed header string\n      } else if (range === -1) {\n        responseData = Buffer.alloc(0); // unsatisfiable range\n        return 416;\n      } else if (range.type === 'bytes') {\n        responseData = Buffer.from(responseData);\n        if (range.length === 1) {\n          const {\n            start,\n            end\n          } = range[0];\n          response.setHeader('Content-Range', `bytes ${start}-${end}/${responseData.length}`);\n          response.setHeader('Accept-Ranges', 'bytes');\n          response.setHeader('Content-Length', end - start + 1);\n          responseData = responseData.slice(start, end + 1);\n          return 206;\n        } else {\n          responseData = Buffer.alloc(0); // Multiple ranges are not supported. Maybe future?\n          return 416;\n        }\n      }\n      return 200; // All other states, ignore\n    }\n\n    if (directory) {\n      filepath = directory + filepath;\n    }\n    if (!content && cache[filepath]) {\n      content = cache[filepath];\n    }\n    if (config && config.customHeaders && config.customHeaders.length > 0) {\n      config.customHeaders.forEach(header => {\n        const regex = new RegExp(header.match);\n        if (regex.test(filepath)) {\n          log.debug(`setting header: ${header.name} for: ${filepath}`);\n          response.setHeader(header.name, header.value);\n        }\n      });\n    }\n    if (content && !doNotCache) {\n      log.debug(`serving (cached): ${filepath}`);\n      response.setHeader('Content-Type', mime.getType(filepath, 'text/plain'));\n      responseData = transform && transform(content) || content;\n      response.writeHead(rangeHeader ? convertForRangeRequest() : 200);\n      return response.end(responseData);\n    }\n    return fs.readFile(filepath, function (error, data) {\n      if (error) {\n        return serve404(response, filepath);\n      }\n      if (!doNotCache) {\n        cache[filepath] = data.toString();\n      }\n      log.debug('serving: ' + filepath);\n      response.setHeader('Content-Type', mime.getType(filepath, 'text/plain'));\n      responseData = transform && transform(data.toString()) || data;\n      response.writeHead(rangeHeader ? convertForRangeRequest() : 200);\n      return response.end(responseData);\n    });\n  };\n}\nfunction serve404(response, path) {\n  log.warn(`404: ${path}`);\n  response.writeHead(404);\n  return response.end('NOT FOUND');\n}\nfunction setNoCacheHeaders(response) {\n  response.setHeader('Cache-Control', 'no-cache');\n  response.setHeader('Pragma', 'no-cache');\n  response.setHeader('Expires', new Date(0).toUTCString());\n}\nfunction setHeavyCacheHeaders(response) {\n  response.setHeader('Cache-Control', 'public, max-age=31536000');\n}\n\n// PUBLIC API\nexports.createServeFile = createServeFile;\nexports.setNoCacheHeaders = setNoCacheHeaders;\nexports.setHeavyCacheHeaders = setHeavyCacheHeaders;\nexports.serve404 = serve404;","map":{"version":3,"names":["mime","require","parseRange","log","create","createServeFile","fs","directory","config","cache","Object","filepath","rangeHeader","response","transform","content","doNotCache","responseData","convertForRangeRequest","range","length","Buffer","alloc","type","from","start","end","setHeader","slice","customHeaders","forEach","header","regex","RegExp","match","test","debug","name","value","getType","writeHead","readFile","error","data","serve404","toString","path","warn","setNoCacheHeaders","Date","toUTCString","setHeavyCacheHeaders","exports"],"sources":["C:/Users/Nawaz/Downloads/mean-stack-authentication-authorization-master/mean-stack-authentication-authorization-master/Frontend/node_modules/karma/lib/middleware/common.js"],"sourcesContent":["/**\n * This module contains some common helpers shared between middlewares\n */\n'use strict'\n\nconst mime = require('mime')\nconst parseRange = require('range-parser')\nconst log = require('../logger').create('web-server')\n\nfunction createServeFile (fs, directory, config) {\n  const cache = Object.create(null)\n\n  return function (filepath, rangeHeader, response, transform, content, doNotCache) {\n    let responseData\n\n    function convertForRangeRequest () {\n      const range = parseRange(responseData.length, rangeHeader)\n      if (range === -2) {\n        return 200 // malformed header string\n      } else if (range === -1) {\n        responseData = Buffer.alloc(0) // unsatisfiable range\n        return 416\n      } else if (range.type === 'bytes') {\n        responseData = Buffer.from(responseData)\n        if (range.length === 1) {\n          const { start, end } = range[0]\n          response.setHeader('Content-Range', `bytes ${start}-${end}/${responseData.length}`)\n          response.setHeader('Accept-Ranges', 'bytes')\n          response.setHeader('Content-Length', end - start + 1)\n          responseData = responseData.slice(start, end + 1)\n          return 206\n        } else {\n          responseData = Buffer.alloc(0) // Multiple ranges are not supported. Maybe future?\n          return 416\n        }\n      }\n      return 200 // All other states, ignore\n    }\n\n    if (directory) {\n      filepath = directory + filepath\n    }\n\n    if (!content && cache[filepath]) {\n      content = cache[filepath]\n    }\n\n    if (config && config.customHeaders && config.customHeaders.length > 0) {\n      config.customHeaders.forEach((header) => {\n        const regex = new RegExp(header.match)\n        if (regex.test(filepath)) {\n          log.debug(`setting header: ${header.name} for: ${filepath}`)\n          response.setHeader(header.name, header.value)\n        }\n      })\n    }\n\n    if (content && !doNotCache) {\n      log.debug(`serving (cached): ${filepath}`)\n      response.setHeader('Content-Type', mime.getType(filepath, 'text/plain'))\n      responseData = (transform && transform(content)) || content\n      response.writeHead(rangeHeader ? convertForRangeRequest() : 200)\n      return response.end(responseData)\n    }\n\n    return fs.readFile(filepath, function (error, data) {\n      if (error) {\n        return serve404(response, filepath)\n      }\n\n      if (!doNotCache) {\n        cache[filepath] = data.toString()\n      }\n\n      log.debug('serving: ' + filepath)\n      response.setHeader('Content-Type', mime.getType(filepath, 'text/plain'))\n      responseData = (transform && transform(data.toString())) || data\n      response.writeHead(rangeHeader ? convertForRangeRequest() : 200)\n\n      return response.end(responseData)\n    })\n  }\n}\n\nfunction serve404 (response, path) {\n  log.warn(`404: ${path}`)\n  response.writeHead(404)\n  return response.end('NOT FOUND')\n}\n\nfunction setNoCacheHeaders (response) {\n  response.setHeader('Cache-Control', 'no-cache')\n  response.setHeader('Pragma', 'no-cache')\n  response.setHeader('Expires', (new Date(0)).toUTCString())\n}\n\nfunction setHeavyCacheHeaders (response) {\n  response.setHeader('Cache-Control', 'public, max-age=31536000')\n}\n\n// PUBLIC API\nexports.createServeFile = createServeFile\nexports.setNoCacheHeaders = setNoCacheHeaders\nexports.setHeavyCacheHeaders = setHeavyCacheHeaders\nexports.serve404 = serve404\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}